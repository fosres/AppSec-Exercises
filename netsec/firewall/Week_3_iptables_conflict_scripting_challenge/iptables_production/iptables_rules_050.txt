# Production Environment
# Site: datacenter-50
# Last updated: 2025-01-02

iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

iptables -A INPUT -i lo -j ACCEPT

iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# Web tier
iptables -A INPUT -p tcp -s 172.16.10.0/24 --dport 8000 -j ACCEPT
iptables -A INPUT -p tcp -s 172.16.11.0/24 --dport 8010 -j ACCEPT
iptables -A INPUT -p tcp -s 172.16.12.0/24 --dport 8020 -j ACCEPT
iptables -A INPUT -p tcp -s 172.16.13.0/24 --dport 8030 -j ACCEPT
iptables -A INPUT -p tcp -s 172.16.14.0/24 --dport 8040 -j ACCEPT
iptables -A INPUT -p tcp -s 172.16.15.0/24 --dport 8050 -j ACCEPT
iptables -A INPUT -p tcp -s 172.16.16.0/24 --dport 8060 -j ACCEPT

# Application tier
iptables -A INPUT -p tcp -s 10.50.0.0/25 --dport 9000 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.1.0/25 --dport 9001 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.2.0/25 --dport 9002 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.3.0/25 --dport 9003 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.4.0/25 --dport 9004 -j ACCEPT

# SSH access
iptables -A INPUT -s 10.0.0.0/20 -p tcp --dport 22 -j ACCEPT

# Database tier
iptables -A INPUT -p tcp -s 192.168.100.0/24 --dport 5432 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.101.0/24 --dport 5433 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.102.0/24 --dport 5434 -j ACCEPT
iptables -A INPUT -p tcp -s 192.168.103.0/24 --dport 5435 -j ACCEPT

# SSH access
iptables -A INPUT -s 10.0.1.0/24 -p tcp --dport 22 -j DROP

# Monitoring
iptables -A INPUT -p tcp -s 10.50.0.0/26 --dport 3000 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.1.0/26 --dport 3001 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.2.0/26 --dport 3002 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.3.0/26 --dport 3003 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.4.0/26 --dport 3004 -j ACCEPT
iptables -A INPUT -p tcp -s 10.50.5.0/26 --dport 3005 -j ACCEPT

# Management
iptables -A INPUT -p tcp -s 192.168.100.0/27 --dport 22 -j ACCEPT

# Logging
iptables -A INPUT -j LOG --log-prefix 'DROP: '
iptables -A INPUT -j DROP